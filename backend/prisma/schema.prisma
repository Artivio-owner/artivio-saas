generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  SUPER_ADMIN
  ADMIN
  MANAGER
  USER
}

/* =======================
   USER / AUTH / RBAC
======================= */

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  role      Role     @default(USER)

  companyId String?
  company   Company? @relation(fields: [companyId], references: [id])

  auditLogs AuditLog[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

/* =======================
   COMPANY â€” SaaS CORE
======================= */

model Company {
  id        String   @id @default(uuid())
  name      String
  slug      String   @unique
  domain    String?
  subdomain String?

  users        User[]
  products     Product[]
  orders       Order[]
  warehouses   Warehouse[]
  landings     Landing[]
  subscription Subscription?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

/* =======================
   SUBSCRIPTION / BILLING
======================= */

model Subscription {
  id        String   @id @default(uuid())
  plan      String
  status    String

  companyId String   @unique
  company   Company  @relation(fields: [companyId], references: [id])

  startedAt DateTime
  endsAt    DateTime?

  createdAt DateTime @default(now())
}

/* =======================
   PRODUCTS + BARCODE / QR
======================= */

model Product {
  id        String   @id @default(uuid())
  name      String
  article   String
  price     Float

  barcode   String?
  qrCode    String?

  companyId String
  company   Company @relation(fields: [companyId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

/* =======================
   WAREHOUSES
======================= */

model Warehouse {
  id        String   @id @default(uuid())
  name      String
  location  String?

  companyId String
  company   Company @relation(fields: [companyId], references: [id])

  createdAt DateTime @default(now())
}

/* =======================
   ORDERS + MARKETPLACES
======================= */

model Order {
  id          String   @id @default(uuid())
  number      String
  status      String

  marketplace Json?
  labelUrl    String?

  companyId   String
  company     Company @relation(fields: [companyId], references: [id])

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

/* =======================
   AUDIT LOG
======================= */

model AuditLog {
  id        String   @id @default(uuid())
  action    String
  entity    String
  entityId  String?

  userId    String?
  user      User?    @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
}

/* =======================
   LANDINGS / CMS / MULTI
======================= */

model Landing {
  id        String   @id @default(uuid())
  key       String
  language  String
  content   Json

  companyId String?
  company   Company? @relation(fields: [companyId], references: [id])

  createdAt DateTime @default(now())
}

model Landing {
  id        String   @id @default(uuid())
  key       String
  language  String
  content   Json
  companyId String?

  @@unique([key, language])
}

model Company {
  id        String   @id @default(uuid())
  name      String
  domain    String   @unique
  createdAt DateTime @default(now())
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  MANAGER
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  role      UserRole
  companyId String?
}

model Product {
  id          String   @id @default(uuid())
  companyId   String
  name        String
  article     String
  price       Float
  createdAt   DateTime @default(now())

  @@unique([companyId, article])
}

model Marketplace {
  id        String   @id @default(uuid())
  code      String   @unique // ozon, wb, ym
  name      String
}

model Order {
  id            String   @id @default(uuid())
  companyId     String
  marketplaceId String?
  createdAt     DateTime @default(now())

  marketplace   Marketplace? @relation(fields: [marketplaceId], references: [id])
  items         OrderItem[]
}

model OrderItem {
  id        String  @id @default(uuid())
  orderId  String
  productId String
  quantity Int

  product Product @relation(fields: [productId], references: [id])
}

model Order {
  id            String   @id @default(uuid())
  companyId     String
  marketplaceId String?
  selfPickup    Boolean  @default(false)
  createdAt     DateTime @default(now())

  marketplace   Marketplace? @relation(fields: [marketplaceId], references: [id])
  items         OrderItem[]
}